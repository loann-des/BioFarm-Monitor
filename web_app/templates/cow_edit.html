{% extends 'base.html' %}
{% block title %}
  Liste des vaches
{% endblock %}
{% block body_class %}
  index-page
{% endblock %}

{% block page_title %}
  {{cow.cow_id}}
{% endblock %}
{% block content %}

{# Détails de la vache #}
<section id="cow_details" class="contact section">
  <div class="container section-title">
    <h2>Détails de {{ cow.cow_id }}</h2> <!-- ID non éditable -->
  </div>

  <form method="POST" action="{{ url_for('cow_liste.update_cow_details', cow_id=cow.cow_id) }}" class="php-email-form">
    <div class="mb-3">
      <label>Dans la ferme :</label>
      <input type="text" name="in_farm" class="form-control" value="{{ cow.in_farm }}">
    </div>

    <div class="mb-3">
      <label>Date de naissance :</label>
      <input type="date" name="born_date" class="form-control" value="{{ cow.born_date }}">
    </div>

    {% for date, info in cow.info %}
      <div class="row gy-4">
        <div class="col-12">
          <label><strong>{{ date }} :</strong></label>
          <input type="text" name="info_{{ loop.index }}" class="form-control" value="{{ info }}">
          <input type="hidden" name="info_date_{{ loop.index }}" value="{{ date }}">
        </div>
      </div>
    {% endfor %}

    <input type="hidden" name="info_count" value="{{ cow.info | length }}">
    <button type="submit" class="btn btn-primary mt-3">Enregistrer</button>
  </form>
</section>
{# END Détails de la vache #}

{# Traitements de la vache #}
  <section id="cow_cares" class="contact section">
    <div class="container section-title">
      <h2>Traitements</h2>
    </div>

    {% for care_index, care in enumerate(cow.cow_cares) %}
      <form method="POST" action="{{ url_for('cow_liste.update_cow_care', cow_id=cow.cow_id, care_index=care_index) }}" class="php-email-form">
        <div class="row gy-4">

          {# Date #}
          <div class="col-md-6">
            <label for="care_date">Date :</label>
            <input type="date" name="care_date" class="form-control" required value="{{ care['date_traitement'] }}" />
          </div>

          {# Médicaments #}
          <div class="col-md-6">
            {% for med_name, qty in care['medicaments'].items() %}
              <label>Médicament :</label>
              <select name="medic_{{ loop.index }}" class="form-select">
                {% for med in pharma_list %}
                  <option value="{{ med }}" {% if med == med_name %}selected{% endif %}>{{ med }}</option>
                {% endfor %}
              </select>
              <input type="number" name="medic_{{ loop.index }}_nb" class="form-control" value="{{ qty }}" min="1" />
            {% endfor %}
          </div>

          {# Info complémentaire #}
          <div class="col-md-12">
            <label for="care_info">Info complémentaire :</label>
            <input type="text" name="care_info" class="form-control" value="{{ care['annotation'] or '' }}" />
          </div>

          <div class="col-md-12 text-center">
            <button type="submit" class="btn btn-warning">Modifier le soin</button>
          </div>

        </div>
      </form>
      <form method="POST" action="{{ url_for('cow_liste.delete_cow_care', cow_id=cow.cow_id, care_index=care_index) }}" onsubmit="return confirm('Confirmer la suppression ?');">
        <button type="submit" class="btn btn-danger">Supprimer ce soin</button>
      </form>

      <hr>
    {% endfor %}



    </div>
  </section>
{# END Traitements de la vache #}

{# Détails de la reproduction #}
  <section id="calving" class="contact section">
    <div class="container section-title">
      <h2>Reproduction</h2>
    </div>
{% for repro_index, repro_tuple in enumerate(cow.reproduction) %}
{% if repro_index > 0 %}

  {% set repro = repro_tuple[0] %}
  {% set info = repro_tuple[1] %}

  <form method="POST" action="{{ url_for('cow_liste.update_cow_reproduction', cow_id=cow.cow_id, repro_index=repro_index) }}" class="php-email-form mb-4">
    <div class="row gy-4">

      <div class="col-md-6">
        <label for="insemination_{{ repro_index }}">Insemination :</label>
        <input type="date" name="insemination" id="insemination_{{ repro_index }}" class="form-control" required
              value="{{ repro.insemination }}" />
      </div>

      <div class="col-md-6">
        <label for="ultrasound_{{ repro_index }}">Ultrasound :</label>
        <select name="ultrasound" id="ultrasound_{{ repro_index }}" class="form-select">
          <option value="" {% if repro.ultrasound is none %}selected{% endif %}>N/A</option>
          <option value="true" {% if repro.ultrasound == true %}selected{% endif %}>Oui</option>
          <option value="false" {% if repro.ultrasound == false %}selected{% endif %}>Non</option>
        </select>
      </div>

      <div class="col-md-6">
        <label for="dry_{{ repro_index }}">Dry period :</label>
        <input type="date" name="dry" id="dry_{{ repro_index }}" class="form-control" required
              value="{{ repro.dry }}" />
      </div>

      <div class="col-md-6">
        <label for="calving_preparation_{{ repro_index }}">Calving preparation :</label>
        <input type="date" name="calving_preparation" id="calving_preparation_{{ repro_index }}" class="form-control" required
              value="{{ repro.calving_preparation }}" />
      </div>

      <div class="col-md-6">
        <label for="calving_date_{{ repro_index }}">Calving date :</label>
        <input type="date" name="calving_date" id="calving_date_{{ repro_index }}" class="form-control" required
              value="{{ repro.calving_date }}" />
      </div>

      <div class="col-md-3">
        <label for="calving_{{ repro_index }}">Calving :</label>
        <select name="calving" id="calving_{{ repro_index }}" class="form-select" required>
          <option value="true" {% if repro.calving %}selected{% endif %}>Oui</option>
          <option value="false" {% if not repro.calving %}selected{% endif %}>Non</option>
        </select>
      </div>

      <div class="col-md-3">
        <label for="abortion_{{ repro_index }}">Abortion :</label>
        <select name="abortion" id="abortion_{{ repro_index }}" class="form-select" required>
          <option value="true" {% if repro.abortion %}selected{% endif %}>Oui</option>
          <option value="false" {% if not repro.abortion %}selected{% endif %}>Non</option>
        </select>
      </div>

      <div class="col-md-12">
        <label for="info_{{ repro_index }}">Info complémentaire :</label>
        <input type="text" name="info" id="info_{{ repro_index }}" class="form-control" value="{{ info or '' }}" />
      </div>

      <div class="col-md-12 text-center mt-3">
        <button type="submit" class="btn btn-warning">Modifier la reproduction</button>
      </div>

    </div>
  </form>

  <form method="POST" action="{{ url_for('cow_liste.delete_cow_reproduction', cow_id=cow.cow_id, repro_index=repro_index) }}" onsubmit="return confirm('Confirmer la suppression ?');">
    <button type="submit" class="btn btn-danger mb-5">Supprimer cette reproduction</button>
  </form>
  <hr>
{% endif %}
{% endfor %}

  </section>
{# END Détails de la reproduction #}

{% endblock %}
{% block JS %}
  <script src="{{ url_for('static', filename='js/forms.js') }}"></script>
{% endblock %}